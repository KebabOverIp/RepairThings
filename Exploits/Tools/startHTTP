#!/bin/bash

# Default values
port="80"       # Default port if not provided
target=""       # Will hold 'win' or 'lin' if specified
curDir=$(pwd)   # Default to current directory


for arg in "$@"; do
    if [[ "$arg" =~ ^[0-9]+$ ]]; then
        # If argument is a number, treat it as the port
        port="$arg"
    elif [[ "$arg" == "win" || "$arg" == "lin" ]]; then
        # If argument is "win" or "lin", treat as directory selector
        target="$arg"
    fi
done


case "$target" in
    win)
        curDir="windows directory" #EDITHERE
        ;;
    lin)
        curDir="linux directory" #EDITHERE
        ;;
    lin)
        curDir="div directory" #EDITHERE
        ;;
    *)
        curDir=$(pwd)  # Default to current working directory
        ;;
esac

lhost=$(ip address show tun0 2>/dev/null | grep -oP '(\d+\.){3}\d+' | head -n 1)
if [ -z "$lhost" ]; then
    echo "[-] Error: 'tun0' interface is not active or has no IP assigned."
    exit 1
fi
if ! [[ "$port" =~ ^[0-9]+$ ]] || [ "$port" -lt 1 ] || [ "$port" -gt 65535 ]; then
    echo "[-] Invalid port: $port. Must be a number between 1 and 65535."
    exit 1
fi
echo "[+] Starting HTTP server on: http://$lhost:$port"
echo "[+] Serving directory: $curDir"
ls -lha "$curDir"

# Start the HTTP server without changing directory
python3 -m http.server "$port" --directory "$curDir"


echo "[+] Server stopped."
